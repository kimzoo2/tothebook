<!DOCTYPE html>
<html lang="ko"
      xmlns:th="https://www.thymeleaf.org">
<head th:replace="~{common/header :: header}">
    <title th:text="회원가입"></title>
</head>
<body class="sidebar-gone">
<div id="app">
    <section class="section">
        <div class="container mt-5">
            <div class="row">
                <div class="col-12 col-sm-10 offset-sm-1 col-md-8 offset-md-2 col-lg-8 offset-lg-2 col-xl-8 offset-xl-2">
                    <div class="login-brand">
                        <img th:src="@{/img/logo.png}" alt="logo" class="shadow-light rounded-circle">
                    </div>

                    <div class="card card-primary">
                        <div class="card-header"><h4>회원가입</h4></div>

                        <div class="card-body">
                            <form method="POST">
                                <div class="row">
                                    <div class="form-group col-2 text-right mb-1">
                                        <label for="email" class="col-form-label-lg">이메일</label>
                                    </div>
                                    <div class="form-group col-7 mb-1">
                                        <input id="email" type="email" class="form-control" name="email" autofocus>
                                    </div>
                                    <div class="form-group col-3 p-0 mb-1 pr-3">
                                        <button type="button"
                                                class="btn btn-primary btn-lg btn-block"
                                                onclick="checkEmail()">인증 번호 전송</button>
                                    </div>
                                </div>
                                <div class="row d-none" id="duplicate-email-div">
                                    <div class="form-group col-2 mb-0"></div>
                                    <div class="form-group col-10 mb-0">
                                        <p class="mb-0 text-danger">중복된 이메일이 존재합니다.</p>
                                    </div>
                                </div>
                                <div class="row mt-2 d-none">
                                    <div class="form-group col-2"></div>
                                    <div class="form-group col-7">
                                        <input id="certificateCode" type="text" class="form-control" name="certificateCode" placeholder="인증 번호를 입력해주세요">
                                    </div>
                                    <div class="form-group col-3 p-0 pr-3">
                                        <button type="button" class="btn btn-primary btn-lg btn-block">인증</button>
                                    </div>
                                </div>

                                <div class="row mt-2">
                                    <div class="form-group col-2 text-right mb-1">
                                        <label for="nickname" class="col-form-label-lg">닉네임</label>
                                    </div>
                                    <div class="form-group col-10 mb-1">
                                        <input id="nickname" type="text" class="form-control" name="nickname">
                                    </div>
                                </div>
                                <div class="row d-none">
                                    <div class="form-group col-2 mb-0"></div>
                                    <div class="form-group col-10 mb-0">
                                        <p class="mb-0 text-danger">중복된 닉네임이 존재합니다.</p>
                                    </div>
                                </div>

                                <div class="row mt-1">
                                    <div class="form-group col-2 text-right mb-1">
                                        <label for="password" class="col-form-label-lg">비밀번호</label>
                                    </div>
                                    <div class="form-group col-10 mb-1">
                                        <input id="password" type="password" class="form-control" name="password">
                                    </div>
                                </div>

                                <div class="row mt-5">
                                    <div class="form-group col-12">
                                        <button type="submit" class="btn btn-primary btn-lg btn-block">
                                            회원가입
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<th:block th:replace="~{common/script :: script}"/>
</body>
</html>
<script type="text/javascript">
    let isDuplicatedEmail = true;

    const checkEmail = () => {
        const emailDiv = document.getElementById('duplicate-email-div');
        const email = $('#email').val();

        if (!validateForCheckEmail(email)) {
            return;
        }

        axios.get('/api/user/is-duplicated/email/' + email)
            .then((response) => {
                if (response.data) {
                    isDuplicatedEmail = true;
                    emailDiv.classList.remove('d-none');
                } else {
                    isDuplicatedEmail = false;
                    emailDiv.classList.add('d-none');
                    sendCertificateNumber();
                }
            })
            .catch((error) => {
                console.log(error);
                alert('오류가 발생했습니다.');
            });
    };

    const validateForCheckEmail = (email) => {
        if (email === undefined || email === null || email === '') {
            alert('이메일을 입력해주세요.');
            return false;
        }

        const regex = new RegExp('[a-z0-9]+@[a-z]+\.[a-z]{2,3}');
        if (!regex.test(email)) {
            alert('이메일 형식이 아닙니다.');
            return false;
        }

        return true;
    }

    const sendCertificateNumber = () => {
        if (isDuplicatedEmail) {
            alert('이메일이 중복됩니다.');
            return;
        }
        console.log('이메일 인증 진행');
    };

    const signUp = () => {
    };
</script>